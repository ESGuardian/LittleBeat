server {
	listen *:80 default_server;
	listen [::]:80 default_server;

	root /var/www/html;

	# Add index.php to the list if you are using PHP
	index index.html index.htm index.nginx-debian.html;

	server_name _;

	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
		try_files $uri $uri/ =404;
	}
}


server {
	listen                *:84;
	listen            [::]:84;
	ssl on;
	ssl_certificate /etc/logstash/logstash.crt;
	ssl_certificate_key /etc/logstash/logstash.pem;
	server_name           doorman;
	access_log            /var/log/nginx/doorman.access.log;
	error_log  /var/log/nginx/doorman.error.log;
	ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
	ssl_ciphers HIGH:!aNULL:!MD5;
	location / {
		include uwsgi_params;
		uwsgi_pass unix:/opt/doorman/doorman.sock;
	}
	location /manage {
		auth_basic "Restricted";
		auth_basic_user_file /etc/nginx/conf.d/kibana.htpasswd;	
		include uwsgi_params;
		uwsgi_pass unix:/opt/doorman/doorman.sock;
	}
}

server {
	listen                *:443;
	listen            [::]:443;
	ssl on;
	ssl_certificate /etc/logstash/logstash.crt;
	ssl_certificate_key /etc/logstash/logstash.pem;
	server_name           littlebeat;
	access_log            /var/log/nginx/kibana.access.log;
	error_log  /var/log/nginx/kibana.error.log;
	set $kibana 127.0.0.1;
	location / {
		auth_basic "Restricted";
		auth_basic_user_file /etc/nginx/conf.d/kibana.htpasswd;
		proxy_pass              http://$kibana:5601;
		proxy_set_header        Host $host;
		proxy_set_header        Referer "";
		proxy_set_header        X-Real-IP $remote_addr;
		proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_http_version      1.1;
		proxy_connect_timeout   150;
		proxy_send_timeout      100;
		proxy_read_timeout      100;
		proxy_buffers           16 64k;
		proxy_busy_buffers_size 64k;
		client_max_body_size    256k;
		client_body_buffer_size 128k;
	}
}
